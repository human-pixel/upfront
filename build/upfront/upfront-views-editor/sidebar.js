!function(e,i){var t=Upfront.Settings&&Upfront.Settings.l10n?Upfront.Settings.l10n.global.views:Upfront.mainData.l10n.global.views;define(["scripts/upfront/upfront-views-editor/sidebar/sidebar-panel","scripts/upfront/upfront-views-editor/sidebar/draggable-element","scripts/upfront/upfront-views-editor/commands","scripts/upfront/upfront-views-editor/sidebar/sidebar-profile","scripts/upfront/upfront-views-editor/sidebar/sidebar-panels","scripts/upfront/upfront-views-editor/sidebar/commands/sidebar-commands-primary-post-type","scripts/upfront/upfront-views-editor/breakpoint","scripts/upfront/upfront-views-editor/sidebar/sidebar-panel-responsive-section-typography","scripts/upfront/upfront-views-editor/sidebar/commands/sidebar-commands-primary-layout"],function(n,s,o,a,r,d,l,m,p){var c=o.Commands.extend({className:"sidebar-commands sidebar-commands-additional",initialize:function(){this.commands=_([])},render:function(){}}),h=o.Commands.extend({className:function(){var e="sidebar-commands sidebar-commands-control";return Upfront.Application.get_current()===Upfront.Settings.Application.MODE.THEME&&(e+=" sidebar-commands-theme"),e},initialize:function(){var e=Upfront.Settings.Application.MODE,i=Upfront.Application.get_current();Upfront.Application.user_can_modify_layout()?i!==e.THEME?(this.commands=_([new o.Command_Undo({model:this.model}),new o.Command_Redo({model:this.model})]),Upfront.Application.user_can("RESPONSIVE_MODE")&&i!==e.THEME&&this.commands.push(new o.Command_StartResponsiveMode({model:this.model})),this.commands.push(new o.Command_ToggleGrid({model:this.model}))):this.commands=_([new o.Command_ToggleGrid({model:this.model})]):this.commands=_([]),Upfront.Application.user_can("RESPONSIVE_MODE")&&i===e.THEME&&this.commands.push(new o.Command_CreateResponsiveLayouts({model:this.model})),i==e.THEME&&this.commands.push(new o.Command_ExportLayout({model:this.model})),this.commands.push(new o.Command_Trash({model:this.model})),!Upfront.Settings.Application.NO_SAVE&&i!==e.THEME&&Upfront.Application.user_can_modify_layout()?this.commands.push(new o.Command_SaveLayout({model:this.model})):i!==e.THEME&&Upfront.Settings.Application.PERMS.REVISIONS&&this.commands.push(new o.Command_PreviewLayout({model:this.model})),Upfront.Settings.Debug.dev&&(Upfront.Settings.Application.NO_SAVE||i===e.THEME||this.commands.push(new o.Command_ResetEverything({model:this.model})),Upfront.Settings.Application.DEBUG||i===e.THEME||Upfront.Settings.Application.NO_SAVE||this.commands.push(new o.Command_PublishLayout({model:this.model})))}}),u=o.Commands.extend({className:"sidebar-commands sidebar-commands-header",initialize:function(){this.commands=_([new o.Command_Logo({model:this.model})]),this.commands.push(new o.Command_Exit({model:this.model}))}}),f=i.View.extend({tagName:"li",className:"sidebar-panel sidebar-panel-settings expanded",template:'<div class="sidebar-panel-content"></div>',initialize:function(){this.collection=l.storage.get_breakpoints(),this.listenTo(this.collection,"change:active",this.render),this.global_option=!0},render:function(){var e=l.storage.get_breakpoints().get_active();e.get("default")&&(this.model.attributes.id="default");var i=new m({model:e.get("default")?this.model:e});i.render(),this.$el.html(this.template),this.$el.find(".sidebar-panel-content").html(i.el)}}),g=i.View.extend({tagName:"ul",className:"sidebar-commands sidebar-commands-responsive",initialize:function(){this.views=[new o.Command_BreakpointDropdown,new o.Command_AddCustomBreakpoint],this.views.push(new f({model:this.model}))},render:function(){return Upfront.Application.user_can_modify_layout()?(_.each(this.views,function(e){e.render(),"undefined"!=typeof e.global_option&&e.global_option?Upfront.Settings.Application.PERMS.OPTIONS&&this.$el.append(e.el):this.$el.append(e.el)},this),this):!1},destroy:function(){this.remove(),_.each(this.views,function(e){e.remove()})}}),b=o.Commands.extend({className:"sidebar-commands sidebar-commands-responsive-control sidebar-commands-control",initialize:function(){Upfront.Application.user_can_modify_layout()?this.commands=_([new o.Command_ResponsiveUndo({model:this.model}),new o.Command_ResponsiveRedo({model:this.model}),new o.Command_ToggleGrid({model:this.model}),new o.Command_SaveLayout,new o.Command_StopResponsiveMode]):this.commands=_([new o.Command_StopResponsiveMode])},render:function(){this.$el.find("li").remove(),this.commands.each(this.add_command,this)}}),v=i.View.extend({tagName:"div",visible:1,events:{"click #sidebar-ui-toggler-handle":"toggleSidebar"},initialize:function(){var e=Upfront.Application.get_current()==Upfront.Settings.Application.MODE.THEME;this.sidebar_profile=new a({model:this.model}),this.sidebar_commands={header:new u({model:this.model}),primary:e?new p({model:this.model}):new d({model:this.model}),additional:e?!1:new c({model:this.model}),control:new h({model:this.model}),responsive:new g({model:this.model})},this.sidebar_panels=new r({model:this.model}),this.fetch_current_user(),Upfront.Application.get_current()!=Upfront.Settings.Application.MODE.CONTENT&&(Upfront.Events.on("upfront:element:edit:start",this.preventUsage,this),Upfront.Events.on("upfront:element:edit:stop",this.allowUsage,this)),Upfront.Events.on("application:mode:after_switch",this.render,this),Upfront.Events.on("application:user:fetch",this.render,this)},preventUsage:function(i){var n=t.not_available_in_text_edit;"media-upload"===i&&(n=t.not_available_in_media_upload),"write"===i&&(this.writingIsOn=!0,n=t.publish_first_nag),this.prevented_usage_type||(this.prevented_usage_type=i),e("#preventUsageOverlay span").html(n),e("#preventUsageOverlay").show()},allowUsage:function(i){return this.writingIsOn&&"write"!==i?void this.preventUsage("write"):(this.prevented_usage_type=!1,this.writingIsOn=!1,void e("#preventUsageOverlay").hide())},render:function(){var i=Upfront.Application.get_current(),t=i===Upfront.Settings.Application.MODE.RESPONSIVE,n=e('<div id="sidebar-ui-wrapper" class="upfront-ui"></div>');if(i==Upfront.Settings.Application.MODE.THEME&&n.addClass("create-theme-sidebar"),this.sidebar_commands.header.render(),n.append(this.sidebar_commands.header.el),i===Upfront.Settings.Application.MODE.THEME||t||(this.sidebar_profile.render(),n.append(this.sidebar_profile.el)),t||(this.sidebar_commands.primary.render(),n.append(this.sidebar_commands.primary.el)),this.sidebar_commands.additional&&!t&&(this.sidebar_commands.additional.render(),n.append(this.sidebar_commands.additional.el)),t&&(this.sidebar_commands.responsive.render(),n.append(this.sidebar_commands.responsive.el)),i===Upfront.Settings.Application.MODE.CONTENT||t){if(t){var s=new b({model:this.model});s.render(),n.append(s.el)}}else this.sidebar_panels.render(),n.append(this.sidebar_panels.el),this.sidebar_commands.control.render(),n.append(this.sidebar_commands.control.el),n.append('<div id="preventUsageOverlay"><span></span></div>');this.$el.html(n),Upfront.Events.trigger("sidebar:rendered")},get_panel:function(e){return this.sidebar_panels.panels[e]?this.sidebar_panels.panels[e]:!1},get_commands:function(e){return this.sidebar_commands[e]?this.sidebar_commands[e]:!1},to_content_editor:function(){},from_content_editor:function(){},fetch_current_user:function(){var e=Upfront.data.currentUser;e||(e=new Upfront.Models.User,Upfront.data.loading.currentUser=e.fetch().done(function(){Upfront.data.currentUser=e,Upfront.Events.trigger("application:user:fetch")}))},addCollapsibleEvents:function(){var i=this;this.$el.append('<div id="sidebar-ui-toggler"><div id="sidebar-ui-toggler-handle" class="sidebar-ui-hide"></div></div>'),e("body").on("mousemove",function(t){300*i.visible+100>t.pageX?i.collapsibleHint||(e("#sidebar-ui-toggler").fadeIn(),i.collapsibleHint=!0):i.collapsibleHint&&(e("#sidebar-ui-toggler").fadeOut(),i.collapsibleHint=!1)}),this.resizeCollapseHandle(),e(window).on("resize",function(){i.resizeCollapseHandle()})},resizeCollapseHandle:function(){var i=e(window).height();this.$("#sidebar-ui-toggler").height(i)},toggleSidebar:function(i){var t=this,n={marginLeft:"260px"};unmargined_css={marginLeft:"0px"},_margin=Upfront.Util.isRTL()?"marginRight":"marginLeft",this.visible?(e("#sidebar-ui, #element-settings-sidebar").stop().animate({width:"0px"},300,function(){e("#sidebar-ui, #element-settings-sidebar").addClass("collapsed")}),Upfront.Util.isRTL()&&(unmargined_css={marginRight:"0px"}),e("#page").stop().animate(unmargined_css,300,function(){Upfront.Events.trigger("sidebar:toggle:done",t.visible)}),this.$("#sidebar-ui-toggler-handle").removeClass().addClass("sidebar-ui-show"),this.visible=0):(Upfront.Util.isRTL()&&(n={marginRight:"260px"}),e("#sidebar-ui").removeClass("collapsed").stop().animate({width:"260px"},300),e("#element-settings-sidebar").removeClass("collapsed"),0!==e("#element-settings-sidebar").contents().length&&e("#element-settings-sidebar").removeClass("collapsed").stop().animate({width:"260px"},300),e("#page").stop().animate(n,300,function(){Upfront.Events.trigger("sidebar:toggle:done",t.visible)}),this.$("#sidebar-ui-toggler-handle").removeClass().addClass("sidebar-ui-hide"),this.visible=1),Upfront.Events.trigger("sidebar:toggle",this.visible)}});return{Sidebar:v,Panel:n,Element:s}})}(jQuery,Backbone);