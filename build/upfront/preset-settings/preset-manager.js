(function(e){define(["scripts/upfront/preset-settings/select-preset-panel","scripts/upfront/preset-settings/util","scripts/upfront/preset-settings/edit-preset-panel"],function(t,n,r){var i=Upfront.Views.Editor.Settings.Settings.extend({initialize:function(e){this.options=e,this.has_tabs=!1,this.presets=new Backbone.Collection(Upfront.mainData[this.mainDataCollection]||[]),this.showSelectPresetPanel(!1)},showSelectPresetPanel:function(e){this.selectPresetPanel=new t({model:this.model,presets:this.presets}),this.panels=_([this.selectPresetPanel]),this.listenTo(this.selectPresetPanel,"upfront:presets:new",this.createPreset),this.listenTo(this.selectPresetPanel,"upfront:presets:edit",this.editPreset),e&&this.render()},getPresetDefaults:function(e){return _.extend(this.presetDefaults,{id:e.toLowerCase().replace(/ /g,"-"),name:e})},updatePreset:function(t){var r,i=n.generateCss(t,this.styleTpl),s;s=this.styleElementPrefix+"-"+t.id,e("style#"+s).length===0&&e("body").append('<style id="'+s+'"></style>'),e("style#"+s).text(i),Upfront.Util.post({action:"upfront_save_"+this.ajaxActionSlug+"_preset",data:t}),_.each(Upfront.mainData[this.mainDataCollection],function(e,n){e.id===t.id&&(r=n)}),_.isUndefined(r)===!1&&Upfront.mainData[this.mainDataCollection].splice(r,1),Upfront.mainData[this.mainDataCollection].push(t)},createPreset:function(e){var t=this.getPresetDefaults(e);this.presets.add(t),this.model.set_property("preset",t.id),this.updatePreset(t),this.editPreset(t.id)},deletePreset:function(e){var t;Upfront.Util.post({data:e.toJSON(),action:"upfront_delete_"+this.ajaxActionSlug+"_preset"}),_.each(Upfront.mainData[this.mainDataCollection],function(n,r){n.id===e.get("id")&&(t=r)}),Upfront.mainData[this.mainDataCollection].splice(t,1),this.model.set_property("preset","default"),this.presets.remove(e),this.showSelectPresetPanel(!0)},editPreset:function(e){this.editPresetPanel=new r({model:this.model,preset:this.presets.findWhere({id:e}),stateFields:this.stateFields}),this.panels=_([this.editPresetPanel]),this.listenTo(this.editPresetPanel,"upfront:presets:update",this.updatePreset),this.listenTo(this.editPresetPanel,"upfront:presets:delete",this.deletePreset),this.$el.html(""),this.render()},get_title:function(){return this.panelTitle}});return i})})(jQuery);