(function(e){define(["scripts/upfront/preset-settings/select-preset-panel","scripts/upfront/preset-settings/util","scripts/upfront/element-settings/settings"],function(e,t,n){var r=Backbone.View.extend({initialize:function(e){this.options=e,this.has_tabs=!1;var t=!1,n;_.each(Upfront.mainData[this.mainDataCollection],function(e,n){e.id==="default"&&(t=!0)}),t||(Upfront.mainData[this.mainDataCollection]=_.isArray(Upfront.mainData[this.mainDataCollection])?Upfront.mainData[this.mainDataCollection]:[],Upfront.mainData[this.mainDataCollection].unshift(this.presetDefaults)),this.presets=new Backbone.Collection(Upfront.mainData[this.mainDataCollection]||[]),this.showSelectPresetPanel(!1)},showSelectPresetPanel:function(t){var n=this;this.selectPresetPanel=new e({model:this.model,presets:this.presets,stateFields:this.stateFields}),this.panels=_([this.selectPresetPanel]),this.delegateEvents(),this.listenTo(this.selectPresetPanel,"upfront:presets:new",this.createPreset),this.listenTo(this.selectPresetPanel,"upfront:presets:delete",this.deletePreset),this.listenTo(this.selectPresetPanel,"upfront:presets:reset",this.resetPreset),this.listenTo(this.selectPresetPanel,"upfront:presets:change",this.changePreset),this.listenTo(this.selectPresetPanel,"upfront:presets:update",this.updatePreset),t&&this.render()},getPresetDefaults:function(e){return _.extend(this.presetDefaults,{id:e.toLowerCase().replace(/ /g,"-"),name:e})},updatePreset:function(e){var n,r;t.updatePresetStyle(this.styleElementPrefix.replace(/-preset/,""),e,this.styleTpl),Upfront.Util.post({action:"upfront_save_"+this.ajaxActionSlug+"_preset",data:e}),_.each(Upfront.mainData[this.mainDataCollection],function(t,r){t.id===e.id&&(n=r)}),_.isUndefined(n)===!1&&Upfront.mainData[this.mainDataCollection].splice(n,1),Upfront.mainData[this.mainDataCollection].push(e)},createPreset:function(e){var t=this.getPresetDefaults(e);this.presets.add(t),this.model.set_property("preset",t.id),this.updatePreset(t)},deletePreset:function(e){var t;Upfront.Util.post({data:e.toJSON(),action:"upfront_delete_"+this.ajaxActionSlug+"_preset"}),_.each(Upfront.mainData[this.mainDataCollection],function(n,r){n.id===e.get("id")&&(t=r)}),Upfront.mainData[this.mainDataCollection].splice(t,1),this.model.set_property("preset","default"),this.presets.remove(e),this.showSelectPresetPanel(!0)},resetPreset:function(e){var n,r=this;Upfront.Util.post({data:e.toJSON(),action:"upfront_reset_"+this.ajaxActionSlug+"_preset"}).success(function(i){t.updatePresetStyle(r.styleElementPrefix.replace(/-preset/,""),i.data,r.styleTpl),_.each(Upfront.mainData[r.mainDataCollection],function(e,t){e.id===i.data.id&&(n=t)}),_.isUndefined(n)===!1&&Upfront.mainData[r.mainDataCollection].splice(n,1),Upfront.mainData[r.mainDataCollection].push(i.data),r.presets=new Backbone.Collection(Upfront.mainData[r.mainDataCollection]||[]),Upfront.Views.Editor.notify("Preset "+e.get("id")+" was reset"),r.$el.empty(),r.selectPresetPanel.remove(),r.showSelectPresetPanel(!0)}).error(function(e){Upfront.Views.Editor.notify(e)})},changePreset:function(e){this.$el.empty(),this.selectPresetPanel.remove(),this.showSelectPresetPanel(!0)},get_title:function(){return this.panelTitle},render:function(){var e=this;e.$el.html('<div class="upfront-settings_title">'+this.get_title()+"</div>"),e.panels.each(function(t){t.render(),e.listenTo(t,"upfront:settings:panel:toggle",e.toggle_panel),e.listenTo(t,"upfront:settings:panel:close",e.close_panel),e.listenTo(t,"upfront:settings:panel:refresh",e.refresh_panel),t.parent_view=e,e.$el.append(t.el)}),this.toggle_panel(this.panels.first())},save_settings:function(){this.panels.each(function(e){e.save_settings()})},toggle_panel:function(e){this.panels.invoke("conceal"),e.$el.find(".upfront-settings_panel").css("height",""),e.show(),e.reveal(),this.set_title(e.get_title())},set_title:function(e){if(!e||!e.length)return!1;this.$el.find(".upfront-settings_title").html(e)},conceal:function(){},reveal:function(){},show:function(){},cleanUp:function(){}});return r})})(jQuery);