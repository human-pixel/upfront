!function(e){var t={selection:[],selecting:!1,create_mergeable:function(t,o){var r=this,n=Upfront.Behaviors.LayoutEditor;r.layout.get("regions");t.$el.selectable({distance:10,filter:".upfront-module",cancel:".upfront-module:not(.upfront-module-spacer), .upfront-module-group, .upfront-region-side-fixed, .upfront-entity_meta, .upfront-region-edit-trigger, .upfront-region-edit-fixed-trigger, .upfront-region-finish-edit, .upfront-icon-control-region-resize, .upfront-inline-modal, .upfront-inline-panels",selecting:function(t,o){var r,i=e(o.selecting);if(!(i.closest(".upfront-module-group").length>0)){if(n.selection.length>0){if(r=e(n.selection[0]).closest(".upfront-region"),i.closest(".upfront-region").get(0)!=r.get(0))return;n._add_selections(r.find(".ui-selecting"),r.find(".upfront-module").not(".upfront-ui-selected, .upfront-module-parent-group"),r.find(".upfront-module-group"))}else n._add_selection(o.selecting);n._update_selection_outline()}},unselecting:function(t,o){var r,i,a=e(o.unselecting);if(n.selection.length>1){if(r=e(n.selection[0]).closest(".upfront-region"),a.closest(".upfront-region").get(0)!=r.get(0))return;return e(".upfront-ui-selected").each(function(){n._remove_selection(this)}),i=r.find(".ui-selecting"),i.length>0&&(n._add_selection(i.get(0)),n._add_selections(i,r.find(".upfront-module").not(".upfront-ui-selected, .upfront-module-parent-group"),r.find(".upfront-module-group"))),void n._update_selection_outline()}n._remove_selection(o.unselecting),n._update_selection_outline()},unselected:function(t,o){var r=e(o.unselected);r.find(".upfront-selected-border").remove(),e(".upfront-module-group-group").remove()},start:function(e,t){n.remove_selections(),n.selection=[],n.selecting=!0},stop:function(e,t){n.parse_selections()}})},refresh_mergeable:function(){this.remove_selections(),e(".ui-selectable").each(function(){e(this).selectable("refresh")})},enable_mergeable:function(){this.remove_selections(),e(".ui-selectable").each(function(){e(this).selectable("enable")})},disable_mergeable:function(){this.remove_selections(),e(".ui-selectable").each(function(){e(this).selectable("disable")})},destroy_mergeable:function(){this.remove_selections(),e(".ui-selectable").each(function(){e(this).selectable("destroy")})},parse_selections:function(){if(!e(".upfront-ui-selected").length)return!1;if(!Upfront.Application.user_can_modify_layout())return!1;var t=this,o=Upfront.Application.layout.get("regions"),r=e(".upfront-ui-selected:first").closest(".upfront-region"),n=o.get_by_name(r.data("name")),i=n?n.get("modules"):!1,a=n?n.get("wrappers"):!1,l=e(".upfront-ui-selected");if(l.length<2)return l.each(function(){t._remove_selection(this)}),e("#upfront-group-selection").remove(),!1;e(".upfront-module-group-group").remove();var s=e('<div class="upfront-module-group-toggle upfront-module-group-group">'+Upfront.Settings.l10n.global.behaviors.group+"</div>"),p=sel_left=sel_right=sel_bottom=!1,u=wrap_left=wrap_right=wrap_bottom=!1,c=group_left=0;e("body").append(s),l.each(function(){var t=e(this).offset(),o=e(this).outerWidth(),r=e(this).outerHeight(),n=e(this).closest(".upfront-wrapper"),i=n.offset(),a=n.outerWidth(),l=n.outerHeight();t.right=t.left+o,t.bottom=t.top+r,p=p===!1||t.top<p?t.top:p,sel_bottom=sel_bottom===!1||t.bottom>sel_bottom?t.bottom:sel_bottom,sel_left=sel_left===!1||t.left<sel_left?t.left:sel_left,sel_right=sel_right===!1||t.right>sel_right?t.right:sel_right,i.right=i.left+a,i.bottom=i.top+l,u=u===!1||i.top<u?i.top:u,wrap_bottom=wrap_bottom===!1||i.bottom>wrap_bottom?i.bottom:wrap_bottom,wrap_left=wrap_left===!1||i.left<wrap_left?i.left:wrap_left,wrap_right=wrap_right===!1||i.right>wrap_right?i.right:wrap_right}),c=p+Math.round((sel_bottom-p)/2)-Math.round(s.outerHeight()/2),group_left=sel_left+Math.round((sel_right-sel_left)/2)-Math.round(s.outerWidth()/2),s.css({position:"absolute",zIndex:999999,top:c,left:group_left}),setTimeout(function(){t.selecting=!1},1e3),s.on("click",function(){var o=Upfront.Views.breakpoints_storage.get_breakpoints().get_active().toJSON(),s=Upfront.Behaviors.GridEditor,p=!1,u=(Math.round((wrap_right-wrap_left)/s.grid.column_width),s.parse_modules_to_lines(i,a,o.id,o.columns)),c=[],d=[],f=[],g=0,m=0,h=0,v=!1;_.each(u,function(t){var o=[],r=[],n=[],i=[],a=[],s=0,u=0,v=0;_.each(t.wrappers,function(t){var c=[],d=[],f=[];_.each(t.modules,function(t){var o=!1;l.each(function(){var r=e(this).attr("id");t.model.get_element_id()==r&&(p===!1&&(p=Upfront.data.module_views[t.model.cid]),c.push(t),o=!0)}),o||(0==c.length?d.push(t):f.push(t))}),c.length>0?(o.push({modules:c,top_modules:d,bottom_modules:f,model:t.model,col:t.col,clear:t.clear,spacer:t.spacer,order:t.order}),s+=t.col,d.length&&i.push({modules:d,model:t.model,col:t.col,clear:t.clear,spacer:t.spacer,order:t.order}),f.length&&a.push({modules:f,model:t.model,col:t.col,clear:t.clear,spacer:t.spacer,order:t.order})):((0==o.length?r:n).push({modules:t.modules,model:t.model,col:t.col,clear:t.clear,spacer:t.spacer,order:t.order}),0==o.length?u+=t.col:v+=t.col)}),o.length>0&&(c.push({wrappers:o,top_wrappers:i,bottom_wrappers:a,col:s}),g=s>g?s:g,r.length>0&&(d.push({wrappers:r,col:u}),m=u>m?u:m),n.length>0&&(f.push({wrappers:n,col:v}),h=v>h?v:h))}),s.start(p,p.model),d.length>1&&(t._do_combine(d,n)||t._do_group(d,n)),0==d.length&&0==f.length&&(v=!0),t._do_group(c,n,!1,v),f.length>1&&(t._do_combine(f,n)||t._do_group(f,n)),s.update_position_data(r.find(".upfront-editable_entities_container:first")),s.update_wrappers(n),e(this).remove(),e("#upfront-group-selection").remove(),t.selection=[]})},_do_group:function(e,t,o,r){var n=this,i=Upfront.Behaviors.GridEditor,a=o===!0,r=r===!0,l=t.get("modules"),s=t.get("wrappers"),p=Upfront.Util.get_unique_id("module-group"),u=new Upfront.Models.ModuleGroup,c=u.get("modules"),d=u.get("wrappers"),f=!1,g=!1,m=!1,h=0,v=!1,b=!1,y=Upfront.Views.breakpoints_storage.get_breakpoints().get_enabled();_.each(e,function(e,o){h=e.col>h?e.col:h,_.each(e.wrappers,function(e,t){var r=new Upfront.Models.Wrapper({}),n=Upfront.Util.get_unique_id("wrapper"),a=Upfront.data.wrapper_views[e.model.cid],p="top_modules"in e&&e.top_modules.length>0,u="bottom_modules"in e&&e.bottom_modules.length>0;r.set_property("wrapper_id",n),r.set_property("class",e.model.get_property_value_by_name("class")),r.replace_class(i.grid["class"]+e.col),0==t&&(r.add_class("clr"),0==o&&(f=e.clear)),d.add(r),_.each(e.modules,function(e,t){var o=l.indexOf(e.model),r=Upfront.data.module_views[e.model.cid];v===!1&&(v=o),e.model.set_property("wrapper_id",n,!0),l.remove(e.model,{silent:!0}),r.$el.detach(),p||u||a.$el.detach(),c.add(e.model)}),0==o&&0==t?(m=e.model.get_wrapper_id(),g=e.model):p||s.remove(e.model)}),"bottom_wrappers"in e&&e.bottom_wrappers.length>1&&(r?n._do_split(e.bottom_wrappers,t):n._do_group([{wrappers:e.bottom_wrappers,col:e.col}],t)),"top_wrappers"in e&&e.top_wrappers.length>1&&(r?(_.each(e.top_wrappers,function(e,t){_.each(e.modules,function(e,t){var o=l.indexOf(e.model);return b===!1?void(b=o):(l.remove(e.model,{silent:!0}),b++,void e.model.add_to(l,b))})}),b!==!1&&(v=b+1),a=!0):n._do_group([{wrappers:e.top_wrappers,col:e.col}],t))}),a&&(g=new Upfront.Models.Wrapper({}),m=Upfront.Util.get_unique_id("wrapper"),s.add(g)),g.set_property("wrapper_id",m),g.replace_class(i.grid["class"]+h),f&&g.add_class("clr"),u.set_property("wrapper_id",m),u.set_property("element_id",p),u.replace_class(i.grid["class"]+h),u.set_property("original_col",h);var U=g&&g.get_property_value_by_name("breakpoint")||{},w=u.get_property_value_by_name("breakpoint")||{};_.each(y,function(e){var t=e.toJSON();t["default"]||U&&U[t.id]&&U[t.id].edited&&(_.isObject(w[t.id])||(w[t.id]={edited:!1}),!w[t.id].edited&&_.isNumber(U[t.id].col)&&(w[t.id].col=U[t.id].col,w[t.id].edited=!0,u.set_property("breakpoint",Upfront.Util.clone(w))))}),u.add_to(l,v),Upfront.Events.trigger("entity:module_group:group",u,t)},_do_combine:function(e,t){var o=(Upfront.Behaviors.GridEditor,t.get("modules")),r=t.get("wrappers"),n=[],i=[],a=!0;if(_.each(e,function(e,t){t in n||(n[t]=[]),_.each(e.wrappers,function(e,o){o in i||(i[o]=[]),n[t][o]=e.col,i[o].push(e)})}),n.length>1)for(var l=1;l<n.length;l++)if(!_.isEqual(n[l-1],n[l])){a=!1;break}return a?(_.each(i,function(e){var t,n=0,i=_.filter(e,function(e){return e.spacer}),a=e.length==i.length;_.each(e,function(e,i){return 0==i?(t=e.model.get_wrapper_id(),n=o.indexOf(_.last(e.modules).model),void(e.spacer&&!a&&(_.each(e.modules,function(e){o.remove(e.model)}),n--))):(r.remove(e.model),void(e.spacer?_.each(e.modules,function(e){o.remove(e.model)}):_.each(e.modules,function(e,r){e.model.set_property("wrapper_id",t,!0),o.remove(e.model,{silent:!0}),n++,e.model.add_to(o,n)})))})}),!0):!1},_do_split:function(e,t){var o=(Upfront.Behaviors.GridEditor,t.get("modules")),r=t.get("wrappers");return _.each(e,function(e,t){var n=new Upfront.Models.Wrapper({}),i=Upfront.Util.get_unique_id("wrapper");n.set_property("wrapper_id",i),n.set_property("class",e.model.get_property_value_by_name("class")),r.add(n),_.each(e.modules,function(e,t){var r=o.indexOf(e.model);e.model.set_property("wrapper_id",i,!0),o.remove(e.model,{silent:!0}),e.model.add_to(o,r)})}),!0},_get_group_position:function(t){var o=sel_left=sel_right=sel_bottom=!1,r=wrap_left=wrap_right=wrap_bottom=!1;return t.each(function(){var t=e(this).offset(),n=Math.round(parseFloat(e(this).css("width"))),i=Math.round(parseFloat(e(this).css("height"))),a=e(this).closest(".upfront-wrapper"),l=a.offset(),s=Math.round(parseFloat(a.css("width"))),p=Math.round(parseFloat(a.css("height")));t.left=Math.round(t.left),t.top=Math.round(t.top),t.right=t.left+n,t.bottom=t.top+i,o=o===!1||t.top<o?t.top:o,sel_bottom=sel_bottom===!1||t.bottom>sel_bottom?t.bottom:sel_bottom,sel_left=sel_left===!1||t.left<sel_left?t.left:sel_left,sel_right=sel_right===!1||t.right>sel_right?t.right:sel_right,l.left=Math.round(l.left),l.top=Math.round(l.top),l.right=l.left+s,l.bottom=l.top+p,r=r===!1||l.top<r?l.top:r,wrap_bottom=wrap_bottom===!1||l.bottom>wrap_bottom?l.bottom:wrap_bottom,wrap_left=wrap_left===!1||l.left<wrap_left?l.left:wrap_left,wrap_right=wrap_right===!1||l.right>wrap_right?l.right:wrap_right}),{element:{top:o,bottom:sel_bottom,left:sel_left,right:sel_right},wrapper:{top:r,bottom:wrap_bottom,left:wrap_left,right:wrap_right}}},_find_affected_el:function(t,o){if(0==this.selection.length)return!1;var r=!1;return t.each(function(){var t=e(this).offset(),n=Math.round(parseFloat(e(this).css("width"))),i=Math.round(parseFloat(e(this).css("height"))),a=Math.round(t.top),l=Math.round(t.left),s=a+i,p=l+n;o.top<s&&o.bottom>a&&o.left<p&&o.right>l&&(r=r!==!1?r.add(e(this)):e(this))}),r},_update_selection_outline:function(){var t=e("#upfront-group-selection"),o=this._get_group_position(e(this.selection));t.length||(t=e('<div id="upfront-group-selection" />'),t.appendTo("body")),t.css({top:o.element.top,left:o.element.left,height:o.element.bottom-o.element.top,width:o.element.right-o.element.left})},_add_selection:function(t){var o=_.find(this.selection,function(e){return e==t});o||(this.selection.push(t),e(t).addClass("upfront-ui-selected"))},_add_selections:function(t,o,r){var n,i,a,l=this,s=[];t.each(function(){var t=this,p=_.find(l.selection,function(e){return e==t}),u=e(o);if(!p){for(s=[],n=l._get_group_position(e(l.selection).add(this)),i=l._find_affected_el(u,n.element);i!==!1;)i.each(function(){s.push(this)}),u=u.not(i),n=l._get_group_position(e(l.selection).add(s)),i=l._find_affected_el(u,n.element);a=l._find_affected_el(r,n.element),a===!1&&_.each(s,function(e){l._add_selection(e)})}})},_remove_selection:function(t){this.selection=_.reject(this.selection,function(e){return e==t}),e(t).find(".upfront-selected-border").remove(),e(t).removeClass("upfront-ui-selected ui-selected")},remove_selections:function(){var t=Upfront.Behaviors.LayoutEditor;e(".upfront-ui-selected").each(function(){t._remove_selection(this)}),t._update_selection_outline(),e(".upfront-module-group-group").remove()},create_undo:function(){this.layout.store_undo_state()},apply_history_change:function(){var e=Upfront.Application.layout.get("regions"),t=e?e.get_by_name("shadow"):!1;e&&t&&(e.remove(t),t=!1),Upfront.Application.layout_view.render()},save_dialog:function(t,o,r,n){e("body").append("<div id='upfront-save-dialog-background' />"),e("body").append("<div id='upfront-save-dialog' />");var i=e("#upfront-save-dialog"),a=e("#upfront-save-dialog-background"),l=(Upfront.Application.layout.get("current_layout"),"");n=!0===n,l+=n?"<p>"+Upfront.Settings.l10n.global.behaviors.this_archive_only+"</p>":"<p>"+Upfront.Settings.l10n.global.behaviors.this_post_only+"</p>",e.each(_upfront_post_data.layout,function(e,t){"type"!=e&&(l+=n?'<span class="upfront-save-button" data-save-as="'+t+'">'+Upfront.Settings.LayoutEditor.ArchiveSpecificity[e]+"</span>":'<span class="upfront-save-button" data-save-as="'+t+'">'+Upfront.Settings.LayoutEditor.Specificity[e]+"</span>")}),location.pathname.indexOf("create_new")>-1||r!==!0?(a.remove(),i.remove(),t.apply(o,["single-post"])):(i.html(l),e("#upfront-save-dialog").on("click",".upfront-save-button",function(){var r=e(this).attr("data-save-as");return a.remove(),i.remove(),t.apply(o,[r]),Upfront.Events.trigger("command:proceed:save:post"),!1}),e("#upfront-save-dialog-background").on("click",function(){return a.remove(),i.remove(),!1}))},is_exporter_start_page:function(){return"upfront"===Upfront.themeExporter.currentTheme},export_single_layout:function(e,t){var o=(Upfront.Application,Upfront.Behaviors.LayoutEditor),r=_upfront_post_data.layout.specificity||_upfront_post_data.layout.item||_upfront_post_data.layout.type;return e.update_loading_text(Upfront.Settings.l10n.global.behaviors.exporting_layout+r),o._export_layout({theme:t}).done(function(){e.done(function(){o.export_modal&&o.export_modal.close(!0),o.clean_region_css()})})},message_dialog:function(t,o){var r=(Upfront.Application,Upfront.Behaviors.LayoutEditor);r.message_modal||(r.message_modal=new Upfront.Views.Editor.Modal({to:e("body"),button:!0,top:120,width:540}),r.message_modal.render(),e("body").append(r.message_modal.el)),r.message_modal.open(function(e,r){r.addClass("upfront-message-modal"),e.html('<h1 class="upfront-modal-title">'+t+"</h1>"),e.append(o)},r)},_get_saved_layout:function(){var t=this,o=new e.Deferred;return Upfront.Application.is_builder()?Upfront.Util.post({action:"upfront_list_theme_layouts"}).success(function(e){t.saved_layouts=e.data,o.resolve(e.data)}).error(function(){o.reject()}):setTimeout(o.reject),o.promise()},_get_themes:function(){var t=this,o=new e.Deferred;return Upfront.Application.is_builder()?Upfront.Util.post({action:"upfront_thx-get-themes"}).success(function(e){t.themes=e,o.resolve(e)}).error(function(){o.reject()}):setTimeout(o.reject),o.promise()},_create_theme:function(t){var o=new e.Deferred;return Upfront.Application.is_builder()?Upfront.Util.post({action:"upfront_thx-create-theme",form:this._build_query(t)}).success(function(e){e&&e.error?o.reject(e.error):o.resolve()}).error(function(){o.reject()}):setTimeout(o.reject),o.promise()},export_element_styles:function(e){return Upfront.Application.is_builder()?void Upfront.Util.post({action:"upfront_thx-export-element-styles",data:e}).success(function(t){return t&&t.error?void Upfront.Views.Editor.notify(t.error):(Upfront.data.styles[e.elementType]||(Upfront.data.styles[e.elementType]=[]),-1===Upfront.data.styles[e.elementType].indexOf(e.stylename)&&Upfront.data.styles[e.elementType].push(e.stylename),void Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.behaviors.style_exported))}).error(function(){Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.behaviors.style_export_fail)}):!1},_export_layout:function(t){var o,r,n,i=new e.Deferred,a={};return Upfront.Application.is_builder()?(o=_.findWhere(Upfront.Application.current_subapplication.get_layout_data().properties,{name:"typography"}),n=_.findWhere(Upfront.Application.current_subapplication.get_layout_data().properties,{name:"layout_style"}),r=_.extend({},Upfront.Util.model_to_json(Upfront.Application.current_subapplication.get_layout_data().properties)),r=_.reject(r,function(e){return _.contains(["typography","layout_style","global_regions"],e.name)}),a={typography:o?JSON.stringify(o.value):"",regions:JSON.stringify(Upfront.Application.current_subapplication.get_layout_data().regions),template:_upfront_post_data.layout.specificity||_upfront_post_data.layout.item||_upfront_post_data.layout.type,layout_properties:JSON.stringify(r),theme:Upfront.themeExporter.currentTheme,layout_style:n?n.value:"",theme_colors:{colors:Upfront.Views.Theme_Colors.colors.toJSON(),range:Upfront.Views.Theme_Colors.range},post_image_variants:Upfront.Content.ImageVariants.toJSON()},Upfront.themeExporter.layoutStyleDirty&&(a.layout_style=e("#layout-style").html(),Upfront.themeExporter.layoutStyleDirty=!1),t&&(a=_.extend(a,t)),Upfront.Util.post({action:"upfront_thx-export-layout",data:a}).success(function(e){e&&e.error?i.reject(e.error):i.resolve()}).error(function(){i.reject()}),i.promise()):(setTimeout(i.reject),i.promise())},clean_region_css:function(){var t=Upfront.Application.cssEditor,o=Upfront.Behaviors.LayoutEditor,r=[t.elementTypes.RegionContainer,t.elementTypes.Region],n=_upfront_post_data.layout,i=n.specificity||n.item||n.type,a=Upfront.Application.layout.get("regions"),l=[],s=[],p=function(t){if(!s[t])return Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.behaviors.region_css_cleaned),void u.resolve();var o=s[t].elementType,r=s[t].styleName;Upfront.Application.get_current()===Upfront.Settings.Application.MODE.THEME?data={action:"upfront_thx-delete-element-styles",data:{stylename:r,elementType:o}}:data={action:"upfront_delete_styles",styleName:r,elementType:o},Upfront.Util.post(data).done(function(){var n=Upfront.data.styles[o].indexOf(r);-1!=n&&Upfront.data.styles[o].splice(n,1),e("#upfront-style-"+r).remove(),p(t+1)})},u=new e.Deferred;return a.each(function(e){var o=e.is_main()?t.elementTypes.RegionContainer.id:t.elementTypes.Region.id,r=i+"-"+e.get("name")+"-style";"global"==e.get("scope");_.isArray(Upfront.data.styles[o])&&-1!=Upfront.data.styles[o].indexOf(r)&&l.push(r),r=o+"-"+e.get("name")+"-style",_.isArray(Upfront.data.styles[o])&&-1!=Upfront.data.styles[o].indexOf(r)&&l.push(r)}),o._get_saved_layout().done(function(e){_.each(r,function(t){_.each(Upfront.data.styles[t.id],function(o){var r=!1;_.each(e,function(e,t){if(t!=i){var n=i.match(new RegExp("^"+t+"-"));o.match(new RegExp("^"+t))&&(!n||n&&!o.match(new RegExp("^"+i)))&&(r=!0)}}),_.contains(l,o)||!o.match(new RegExp("^"+i))||r||s.push({elementType:t.id,styleName:o})})}),s.length>0&&(Upfront.Views.Editor.notify(Upfront.Settings.l10n.global.behaviors.cleaning_region_css),p(0))}),u.promise()},_build_query:function(e){return _.map(e,function(e,t){return t+"="+e}).join("&")},clean_global_regions:function(){Upfront.data.global_regions=!1},open_global_region_manager:function(){var t=Upfront.Behaviors.LayoutEditor;Upfront.Popup.open(function(o,r,n){var i=e(this);i.html('<p class="upfront-popup-placeholder">'+Upfront.Settings.l10n.global.behaviors.loading_content+"</p>"),Upfront.data.global_regions?t._render_global_region_manager(i):t._refresh_global_regions().done(function(){t._render_global_region_manager(i)})},{width:600},"global-region-manager")},_refresh_global_regions:function(){return Upfront.Util.post({action:"upfront_list_scoped_regions",scope:"global",storage_key:_upfront_save_storage_key}).done(function(e){Upfront.data.global_regions=e.data})},_render_global_region_manager:function(t){var o=Upfront.Behaviors.LayoutEditor,r=Upfront.Application.layout.get("regions"),n=[{title:Upfront.Settings.l10n.global.behaviors.global_regions,classname:"global",data:_.sortBy(Upfront.data.global_regions,function(e,t,o){return e.container&&e.name!=e.container?3*_.indexOf(o,_.findWhere(o,{name:e.container}))+1:3*t})},{title:Upfront.Settings.l10n.global.behaviors.lightboxes,classname:"lightbox",data:Upfront.Util.model_to_json(r.filter(function(e){return"lightbox"==e.get("sub")}))}];t.html(""),_.each(n,function(r){var n=e('<div class="global-region-manager-wrap global-region-manager-'+r.classname+'"></div>'),i=e('<h3 class="global-region-manager-title">'+r.title+"</h3>"),a=e('<div class="global-region-manager-content upfront-scroll-panel"></div>');n.append([i,a]),o._render_regions(r.data,a),t.append(n),Upfront.Views.Mixins.Upfront_Scroll_Mixin.stop_scroll_propagation(a)}),t.on("click",".region-list-edit",function(e){e.preventDefault()}),t.on("click",".region-list-trash",function(n){n.preventDefault();var i=e(this).attr("data-name");e(this).closest(".global-region-manager-wrap").hasClass("global-region-manager-global")&&confirm("Deleting the global regions will remove it from all layouts. Continue?")&&Upfront.Util.post({action:"upfront_delete_scoped_regions",scope:"global",name:i,storage_key:_upfront_save_storage_key}).done(function(e){e.data&&(_.each(e.data,function(e){var t=r.get_by_name(e);r.remove(t)}),o._refresh_global_regions().done(function(){o._render_global_region_manager(t)}))})})},_render_regions:function(t,o){var r=e('<ul class="global-region-manager-lists"></ul>');_.each(t,function(e){var o=["global-region-manager-list"],n=!1;e.container&&e.name!=e.container?(n=_.find(t,function(t){return t.name==e.container}),o.push("region-list-sub"),o.push("region-list-sub-"+e.sub),n&&o.push("region-list-sub-has-main")):o.push("region-list-main"),r.append('<li class="'+o.join(" ")+'"><span class="region-list-name">'+e.title+'</span><span class="region-list-control">'+(Upfront.Application.get_current()!=Upfront.Settings.Application.MODE.THEME?'<a href="#" class="region-list-trash" data-name="'+e.name+'">'+Upfront.Settings.l10n.global.behaviors.trash+"</a>":"")+"</span></li>")}),o.append(r)}};define(t)}(jQuery);