!function(n){define(["scripts/upfront/inline-panels/control","text!scripts/upfront/inline-panels/templates/link-control-template.html"],function(t,e){var i=Upfront.mainData.l10n.image_element,o=t.extend({multiControl:!0,hideOnClick:!0,events:{click:"onClickControl","click .upfront-apply":"close","click .upfront-link-back":"close"},initialize:function(n){var t=this;this.options=n||{},this.listenTo(Upfront.Events,"dialog-control:open",function(n){t!==n&&t.close()})},render:function(){t.prototype.render.call(this,arguments);var o,l=this;this.$el.hasClass("link-control-panel-item")||this.$el.addClass("link-control-panel-item"),this.view&&(this.view.render(),this.view.delegateEvents()),this.panel||(o=n(_.template(e,{l10n:i.template,hideOkButton:this.hideOkButton})),o.addClass("inline-panel-control-dialog"),o.addClass("inline-panel-control-dialog-"+this.id),this.$el.append(o),o.find(".link-control-panel-content").html("").append(this.view.$el),this.panel=o,n(document).on("click.dialog-control."+l.cid,l,l.onDocumentClick));var s='<span class="upfront-control-arrow"></span>';return this.$el.find(".link-control-panel").prepend(s),this},remove:function(){n(document).off("click.dialog-control."+this.cid)},onDocumentClick:function(t){var e=n(t.target),i=t.data;e.closest("#page").length&&e[0]!==i.el&&!e.closest(i.el).length&&i.isopen&&i.close()},onClickControl:function(t){return this.$el.siblings(".upfront-control-dialog-open").removeClass("upfront-control-dialog-open"),!n(t.target).closest(".upfront-icon").length||n(t.target).closest("upfront-icon-media-label-delete").length?void t.stopPropagation():(t.preventDefault(),this.clicked(t),this.$el.siblings(".upfront-control-dialog-open").removeClass("upfront-control-dialog-open"),void(this.isopen?this.close():this.open()))},onClickOk:function(n){n.preventDefault(),this.trigger("panel:ok",this.view)},bindEvents:function(){this.panel.find("button").on("click",function(){})},open:function(){if(this.isopen=!0,this.$el.addClass("upfront-control-dialog-open"),this.trigger("panel:open"),Upfront.Events.trigger("dialog-control:open",this),this.update_position(),this.updateWrapperSize(),this.$el.is("#link")){var t=this.$el.closest(".upfront-region-container"),e=n(".upfront-region-container").not(".upfront-region-container-shadow").last();e.get(0)==t.get(0)&&t.addClass("upfront-last-region-padding")}return this},close:function(){return this.isopen?(this.isopen=!1,this.$el.removeClass("upfront-control-dialog-open"),this.trigger("panel:close"),this.$el.closest(".upfront-region-container").removeClass("upfront-last-region-padding"),this):this},update_position:function(){var n=this.$el.prevAll().length-1,t=28*n,e=Upfront.Util.isRTL()?"right":"left";this.$el.find(".link-control-panel-content").css(e,-t),this.$el.find(".ulinkpanel-dark").css("minWidth",this.$el.parent().width()),this.$el.find(".upfront-control-arrow").css(e,-t)},updateWrapperSize:function(){var t=0;this.$el.find(".ulinkpanel-dark").children().each(function(e,i){var o=n(i).hasClass("upfront-settings-link-target")?0:parseInt(n(i).width());t+=o}),this.$el.find(".ulinkpanel-dark").css("width",t+20)}});return o})}(jQuery);