(function(e){var t=function(e){var t=(new Date).getTime(),n=Math.max(0,16-(t-lastTime)),r=setTimeout(function(){e(t+n)},n);return lastTime=t+n,r},n=e.proxy(window.requestAnimationFrame,window)||e.proxy(window.webkitRequestAnimationFrame,window)||e.proxy(window.mozRequestAnimationFrame,window)||e.proxy(window.oRequestAnimationFrame,window)||e.proxy(window.msRequestAnimationFrame,window)||t;e.fn.uparallax=function(t){var n=typeof t=="string",i=n?Array.prototype.slice.call(arguments,1):[],s;return this.each(function(){var o=e(this),u=o.data("uparallax");u?n&&(s=u.callMethod(t,i)):n?e.error("Can't call the method "+t+". The object is not initialized"):o.data("uparallax",new r(o,t))}),this.length==1&typeof s!="undefined"?s:this};var r=function(t,n){var i=this,s=e.extend({autostart:!0,element:"",effect:"scroll",movement:30,rotation:15,scaling:1.1,opacity:.5},n);this.opts=s,this.$parent=t,this.$element=typeof this.opts.element=="string"?t.find(this.opts.element):this.opts.element,r.id++,this.id=r.id,r.instances[this.id]=this,this.opts.autostart&&this.start()};r.id=0,r.instances={},r.prevTime=0,r.cache={scrollTop:0,winHeight:0,scrollBottom:0},r.start=function(){r.draw()},r.draw=function(t){var i=e(window).scrollTop();if(r.cache.scrollTop==i){n(r.draw);return}var s=e(window).height(),o=Math.round(i+s);r.cache.scrollTop=i,r.cache.winHeight=s,r.cache.scrollBottom=o;for(id in r.instances)r.instances[id].draw(t);r.prevTime=t,n(r.draw)},r.prototype={cache:{},callMethod:function(e,t){switch(e){case"start":this.start();break;case"stop":this.stop();break;case"destroy":this.destroy();break;case"refresh":this.refresh();break;case"setOption":this.setOption(t[0],t[1]);break;case"setEffect":this.setOption("effect",t[0]);break;case"setMovement":this.setOption("movement",t[0]);break;case"setOpacity":this.setOption("opacity",t[0]);break;case"setRotation":this.setOption("rotation",t[0]);break;case"setScaling":this.setOption("scaling",t[0])}},bindEvents:function(){e(window).on("resize.upfront_parallax_"+this.id,e.proxy(this.refreshCache,this))},unbindEvents:function(){e(window).off("resize.upfront_parallax_"+this.id)},setOption:function(e,t){this.opts[e]=t,this.refresh()},start:function(){this.$parent.addClass("upfront-parallax"),this.$element.addClass("upfront-parallax-element"),this.reset_cache(),this.refresh(),this.bindEvents(),r.prevTime==0&&r.start()},stop:function(){this.$parent.removeClass("upfront-parallax"),this.$element.removeClass("upfront-parallax-element"),this.reset(),this.unbindEvents()},reset_cache:function(){this.cache={translate:0,offsetTop:0,height:0}},reset:function(){this.$element.css({transform:"",opacity:""})},destroy:function(){this.stop(),delete r.instances[this.id],this.$parent.removeData("uparallax")},refresh:function(){this.refreshCache();var t=this.cache.height,n=e(window).height(),r=Math.round((n-t)/2);r-this.opts.movement>this.opts.movement?this.movementOffset=r-this.opts.movement:this.movementOffset=this.opts.movement,this.$element.css({top:this.movementOffset*-1,height:t+this.movementOffset*2}),this.update()},refreshCache:function(){var e=this.$parent.offset(),t=this.$parent.height();this.cache.offsetTop=e.top,this.cache.height=t},update:function(){n(e.proxy(this.draw,this))},draw:function(e){var t=this.cache.offsetTop,n=this.cache.height,s=r.cache.scrollTop,o=r.cache.winHeight,u=r.cache.scrollBottom,a=this.movementOffset*2+this.opts.movement*2,f=2*this.movementOffset,l=this.movementOffset>0?f/a:1,c=Math.round(l*(u-t-n))-this.movementOffset,h=Math.round(l*o)-this.movementOffset,p=h*-1,d=this.opts.effect.split(","),v="";c>h?c=h:c<p&&(c=p);if(this.cache.translate==c)return;this.cache.translate=c;for(i in d){var m=this.getEffect(d[i],c,h);m.property=="transform"?(v+=v==""?"":" ",v+=m.value):this.$element.css(m.property,m.value)}v!==""&&this.$element.css("transform",v)},getEffect:function(e,t,n){var r="transform",i="",s=t/n;switch(e){case"scroll":i="translateY("+t+"px)";break;case"rotate":i="rotate("+s*this.opts.rotation+"deg)";break;case"scale":i="scale("+(1-(1-this.opts.scaling)*Math.abs(s))+")";break;case"opacity":r="opacity",i=1-(1-this.opts.opacity)*Math.abs(s)}return{property:r,value:i}}}})(jQuery);